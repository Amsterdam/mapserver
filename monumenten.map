#==============================================================================
#
# monumenten.map
# doel: serveren monument locaties
#
#==============================================================================



MAP
  NAME                      "monumenten"
  INCLUDE                   "header.inc"
  DEBUG 1

  WEB
    METADATA
      "ows_title"           "monumenten"
      "ows_abstract"        "Monumenten Amsterdam"
      "wms_extent"          "100000 450000 150000 500000"
    END
  END

  #-----------------------------------------------------------------------------

  LAYER
    NAME                    "monument_coordinaten_nopand"
    GROUP                   "monumenten"
    PROJECTION
      "init=epsg:28992"
    END

    INCLUDE                 "connection/monumenten.inc"
    # Some monuments have a detailed monumentgeometrie; some have only
    # POINT-typed monumentcoordinaten. Draw a 1.5m-radius circle around the
    # latter so mapserver will display them and their labels. This isn't
    # quite as pretty as a scale-invariant symbol, but it works.
    DATA "
        geometrie FROM (
            SELECT coalesce(ST_CollectionExtract(monumentgeometrie, 3),
                            ST_Buffer(monumentcoordinaten, 1.5)) AS geometrie,
                   id FROM public.dataset_monument
            ) AS query
        USING srid=28992 USING UNIQUE id"
    TYPE                    POLYGON
    MINSCALEDENOM           10
    MAXSCALEDENOM           400000

    METADATA
      "wfs_title"           "monument_nopand"
      "wfs_srs"             "EPSG:28992"
      "wfs_adstract"        "Monument coordinaten Amsterdam"
      "wfs_enable_request"  "*"
      "gml_featureid"       "ID"
      "gml_include_items"   "id,external_id,monument_aanwijzingsdatum,in_onderzoek,monumentnummer,monumentnaam,display_naam,betreft_pand,heeft_als_grondslag_beperking,monumentstatus,geometry"
      "wms_title"           "monument_coordinaten_nopand"
      "wms_enable_request"  "*"
      "wms_group_title"     "monumenten"
      "wms_abstract"        "Monument coordinaten Amsterdam no pand"
      "wms_srs"             "EPSG:28992"
      "wms_name"            "monument_coordinaten_nopand"
      "wms_format"          "image/png"
      "wms_server_version"  "1.1.1"
      "wms_extent"          "100000 450000 150000 500000"
    END

    LABELITEM               "display_naam"

    FILTER                 ("[monumenttype]" != 'Pand' and "[monumenttype]" != 'Bouwblok')

    CLASS
      NAME                  "Monument (overige)"
      STYLE
        MINSCALEDENOM       10
        MAXSCALEDENOM       5001
        COLOR               255 255 255
        OUTLINECOLOR        0 0 0
      END

      LABEL
        MINSCALEDENOM  10
        MAXSCALEDENOM  1000
        COLOR          102 102 102
        OUTLINECOLOR   255 255 255
        OUTLINEWIDTH   3
        FONT           "Ubuntu-M"
        TYPE           truetype
        SIZE           10
        POSITION       AUTO
        PARTIALS       FALSE
        OFFSET         -60 10
      END

    END
  END

  #-----------------------------------------------------------------------------

  LAYER
    NAME                    "monument_coordinaten"
    GROUP                   "monumenten"
    PROJECTION
      "init=epsg:28992"
    END

    INCLUDE                 "connection/monumenten.inc"
    # See comment at previous layer.
    DATA "
        geometrie FROM (
            SELECT coalesce(ST_CollectionExtract(monumentgeometrie, 3),
                            ST_Buffer(monumentcoordinaten, 2.5)) AS geometrie,
                   * FROM public.dataset_monument
            ) AS query
        USING srid=28992 USING UNIQUE id"
    TYPE                    POLYGON
    MINSCALEDENOM           10
    MAXSCALEDENOM           400000

    METADATA
      "wfs_title"           "monument_coordinaten"
      "wfs_srs"             "EPSG:28992"
      "wfs_adstract"        "Monument coordinaten Amsterdam"
      "wfs_enable_request"  "*"
      "gml_featureid"       "ID"
      "gml_include_items"   "id,external_id,monument_aanwijzingsdatum,in_onderzoek,monumentnummer,monumentnaam,display_naam,betreft_pand,heeft_als_grondslag_beperking,monumentstatus,geometry"
      "wms_title"           "monument_coordinaten"
      "wms_enable_request"  "*"
      "wms_group_title"     "monumenten"
      "wms_abstract"        "Monument coordinaten Amsterdam"
      "wms_srs"             "EPSG:28992"
      "wms_name"            "monument_coordinaten"
      "wms_format"          "image/png"
      "wms_server_version"  "1.1.1"
      "wms_extent"          "100000 450000 150000 500000"
    END

    LABELITEM               "display_naam"

    FILTER                  ("[monumenttype]" = 'Pand' or "[monumenttype]" = 'Bouwblok')

    CLASS
      NAME                  "Monument (pandgerelateerd)"
      STYLE
        MINSCALEDENOM       10
        MAXSCALEDENOM       5001
        COLOR               102 102 102
        OUTLINECOLOR        0 0 0
      END

      LABEL
        MINSCALEDENOM  10
        MAXSCALEDENOM  1000
        COLOR          102 102 102
        OUTLINECOLOR   255 255 255
        OUTLINEWIDTH   3
        FONT           "Ubuntu-M"
        TYPE           truetype
        SIZE           10
        POSITION       AUTO
        PARTIALS       FALSE
        OFFSET         -60 10
      END

    END
  END

END
