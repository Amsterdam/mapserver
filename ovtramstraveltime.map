MAP
  NAME "OV TRAMS TRAVELTIME"
  INCLUDE "header.inc"

  WEB
    METADATA
      "ows_title"    "ov trams traveltime"
      "ows_abstract" "Traveltime OV Trams visualization"
      "wms_extent"   "100000 450000 150000 500000"
    END
  END

  #=============================================================================
  # LAYERS
  #=============================================================================

  LAYER
    NAME            "ovtramstraveltime_by_day"
    INCLUDE         "connection_externaldata.inc"

    VALIDATION
       # %date% substitutions can only have letters, digits and underscore
       'default_date' '2019-04-03' 
       'date'     '^[0-9]{4}-[0-9]{2}-[0-9]{2}$'

       # %bucket% substitutions can only be 1, 2 or 3 that translates to: morning rushhour, evening rushhour and rest of day respectively.
       'default_bucket' '1'
       'bucket'     '[1-3]'
    END  

    DATA            "geo_location FROM (select * from public.sum_ovkv6_tramlines_speed where vehicle_date='%date%' and bucket='%bucket%') as subquery USING srid=4326 USING UNIQUE id"
    TYPE            LINE
    MINSCALEDENOM   100
    MAXSCALEDENOM   400001
    TEMPLATE        "fooOnlyForWMSGetFeatureInfo.html"
    PROJECTION
      "init=epsg:4326"
    END

    METADATA
      "ows_title"           "ovtramstraveltime_by_day"
      "ows_group_title"     "ovtramstraveltime_by_day"
      "ows_abstract"        "ovtramstraveltime per ov regio Amsterdam"
      "gml_featureid"       "ID"
      "gml_include_items"   "all"
      "gml_types"           "auto"
    END
    INCLUDE         "includes/ovspeed_classes.inc"
  END

  LAYER
    NAME            "latest_ovtramstraveltime"
    INCLUDE         "connection_externaldata.inc"

    DATA            "geo_location FROM (select * from public.sum_ovkv6_tramlines_speed where vehicle_date=(select max(vehicle_date) from public.sum_ovkv6_tramlines_speed)) as subquery USING srid=4326 USING UNIQUE id"
    TYPE            LINE
    MINSCALEDENOM   100
    MAXSCALEDENOM   400001
    TEMPLATE        "fooOnlyForWMSGetFeatureInfo.html"
    PROJECTION
      "init=epsg:4326"
    END

    METADATA
      "ows_title"           "latest_ovtramstraveltime"
      "ows_group_title"     "latest_ovtramstraveltime"
      "ows_abstract"        "latest ovtramstraveltime per ov regio Amsterdam"
      "gml_featureid"       "ID"
      "gml_include_items"   "all"
      "gml_types"           "auto"
    END
    INCLUDE         "includes/ovspeed_classes.inc"
  END
END

